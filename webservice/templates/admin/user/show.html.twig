{% extends 'layout.html.twig' %}

{% block title %}{% trans %}User Management{% endtrans %} - {{ user.displayName }}{% endblock %}

{% block main %}
	<main class="main-container mx-auto p-4">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="{{ path('web_admin_home') }}">{% trans %}Administration{% endtrans %}</a></li>
				<li class="breadcrumb-item"><a href="{{ path('web_admin_user_overview') }}">{% trans %}Users{% endtrans %}</a></li>
				<li class="breadcrumb-item active" aria-current="page">{{ user.displayName }}</li>
			</ol>
		</nav>

		<h1 class="mb-4">
			<span class="badge bg-secondary me-2">
				<twig:ux:icon name="bi:person" height="20" width="20" aria-hidden="true" class="bi align-baseline"/>
			</span>
			{{ user.displayName }}
		</h1>

        {% if is_granted('ROLE_USERMANAGEMENT_EDITUSER') %}
            <a href="{{ path('web_admin_user_edit', {id: user.id}) }}" class="btn btn-outline-primary">
                {% trans %}Edit{% endtrans %}
            </a>
        {% endif %}

		<div class="row mt-2">
			<div class="py-3 col-12 col-md">
				<h3>{% trans %}Details{% endtrans %}</h3>
				<dl>
					<dt>{% trans %}Username{% endtrans %}</dt>
					<dd>{{ user.username }}</dd>
					<dt>{% trans %}Display Name{% endtrans %}</dt>
					<dd>{{ user.displayname ?? '-' }}</dd>
				</dl>
			</div>
			<div class="py-3 col-12 col-md">
				<h3>{% trans %}Authentication{% endtrans %}</h3>
				<dl>
					<dt>{% trans %}SSO Provider{% endtrans %}</dt>
					<dd>
						{% if user.externalId %}
							<span class="badge bg-success">
								<twig:ux:icon name="bi:link-45deg" height="14" width="14" aria-hidden="true" class="bi me-1"/>
								{% trans %}Connected{% endtrans %}
							</span>
						{% else %}
							<span class="badge bg-secondary">
								<twig:ux:icon name="bi:x-lg" height="14" width="14" aria-hidden="true" class="bi me-1"/>
								{% trans %}Not connected{% endtrans %}
							</span>
						{% endif %}
					</dd>
					<dt>{% trans %}Local Login{% endtrans %}</dt>
					<dd>
						{% if user.hasPassword %}
							<span class="badge bg-success">
								<twig:ux:icon name="bi:key" height="14" width="14" aria-hidden="true" class="bi me-1"/>
								{% trans %}Password set{% endtrans %}
							</span>
						{% else %}
							<span class="badge bg-secondary">
								<twig:ux:icon name="bi:x-lg" height="14" width="14" aria-hidden="true" class="bi me-1"/>
								{% trans %}No password{% endtrans %}
							</span>
						{% endif %}
					</dd>
				</dl>
			</div>
		</div>

		<div class="row mt-3">
            <div>
			<h3>{% trans %}Roles{% endtrans %}</h3>
			<ul class="list-group">
				{% for role in user.roles %}
					<li class="list-group-item">
						<twig:ux:icon name="bi:shield-check" height="16" width="16" aria-hidden="true" class="bi me-2"/>
						{{ role }}
					</li>
				{% else %}
					<li class="list-group-item text-muted">{% trans %}No roles assigned{% endtrans %}</li>
				{% endfor %}
			</ul>
            </div>
		</div>

		{% if is_granted('ROLE_USERMANAGEMENT_DELETEUSER') %}
		<div class="row gx-5">
			<div class="mt-5 py-3 bg-danger text-bg-danger">
				<h3>{% trans %}Danger Zone{% endtrans %}</h3>
				<p>{% trans %}This action is destructive and cannot be undone.{% endtrans %}</p>
				{% if user.username == app.user.userIdentifier %}
					<p class="fw-bold">{% trans %}You cannot delete your own account.{% endtrans %}</p>
				{% else %}
					{{ form_start(delete_form) }}
					{{ form_errors(delete_form) }}
					{{ form_widget(delete_form.delete, {'attr': {'class': 'mt-3 btn btn-outline-light'}}) }}
					{{ form_end(delete_form) }}
				{% endif %}
			</div>
		</div>
		{% endif %}
	</main>
{% endblock %}
