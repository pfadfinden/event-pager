<div{{ attributes }}>
    {# Hidden field for form submission - stores comma-separated IDs #}
    <input type="hidden" name="{{ fieldName }}" value="{{ selectedRecipients|column('id')|join(', ') }}">

    <label class="form-label">{% trans %}Recipients{% endtrans %}</label>

    {# Search input #}
    <div class="input-group mb-2">
        <span class="input-group-text">
            <twig:ux:icon name="bi:search" height="16" width="16" aria-hidden="true" class="bi"/>
        </span>
        <input
            type="search"
            class="form-control"
            placeholder="{{ 'Search recipients...'|trans }}"
            data-model="search"
            autocomplete="off"
        >
    </div>

    {# Search results dropdown #}
    {% set searchResults = computed.searchResults|default([]) %}
    {% if search is not empty and searchResults is iterable %}
        <div class="list-group mb-3" style="max-height: 200px; overflow-y: auto;">
            {% for result in searchResults %}
                <button
                    type="button"
                    class="list-group-item list-group-item-action d-flex align-items-center"
                    data-action="live#action"
                    data-live-action-param="addRecipient"
                    data-live-id-param="{{ result.id }}"
                >
                    {% if result.type == 'GROUP' %}
                        <twig:ux:icon name="bi:people-fill" height="16" width="16" aria-hidden="true" class="bi me-2 text-primary"/>
                    {% elseif result.type == 'ROLE' %}
                        <twig:ux:icon name="bi:person-badge-fill" height="16" width="16" aria-hidden="true" class="bi me-2 text-warning"/>
                    {% else %}
                        <twig:ux:icon name="bi:person-fill" height="16" width="16" aria-hidden="true" class="bi me-2 text-secondary"/>
                    {% endif %}
                    {{ result.name }}
                    <span class="badge bg-secondary ms-auto">{{ result.type }}</span>
                </button>
            {% else %}
                <div class="list-group-item text-muted">{% trans %}No recipients found{% endtrans %}</div>
            {% endfor %}
        </div>
    {% endif %}

    {# Selected recipients #}
    <div class="border rounded p-2" style="min-height: 60px;">
        {% if selectedRecipients is empty %}
            <p class="text-muted mb-0 small">{% trans %}No recipients selected. Use the search above to add recipients.{% endtrans %}</p>
        {% else %}
            <div class="d-flex flex-wrap gap-2">
                {% for recipient in selectedRecipients %}
                    <span class="badge bg-primary d-flex align-items-center gap-1 py-2 px-2">
                        {% if recipient.type == 'GROUP' %}
                            <twig:ux:icon name="bi:people-fill" height="14" width="14" aria-hidden="true" class="bi"/>
                        {% elseif recipient.type == 'ROLE' %}
                            <twig:ux:icon name="bi:person-badge-fill" height="14" width="14" aria-hidden="true" class="bi"/>
                        {% else %}
                            <twig:ux:icon name="bi:person-fill" height="14" width="14" aria-hidden="true" class="bi"/>
                        {% endif %}
                        {{ recipient.name }}
                        <button
                            type="button"
                            class="btn-close btn-sm btn-close-white ms-1"
                            style="font-size: 0.6rem;"
                            aria-label="{{ 'Remove'|trans }}"
                            data-action="live#action"
                            data-live-action-param="removeRecipient"
                            data-live-id-param="{{ recipient.id }}"
                        ></button>
                    </span>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="form-text text-muted">{% trans %}Search and select recipients for this predefined message.{% endtrans %}</div>
</div>
