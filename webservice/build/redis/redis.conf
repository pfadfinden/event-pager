############################################
# Redis 8.4 durable configuration for Messenger
############################################

dir /data

# --- Persistence (AOF) ---
appendonly yes
appendfsync everysec
aof-use-rdb-preamble yes
aof-load-truncated yes
aof-rewrite-incremental-fsync yes

# --- Disable RDB-only snapshots (unsafe for queues) ---
save ""

# --- Memory safety ---
maxmemory 200mb
maxmemory-policy noeviction
oom-score-adj no

# --- Redis Streams tuning ---
stream-node-max-bytes 4096
stream-node-max-entries 100

# --- Network ---
bind 0.0.0.0
protected-mode no

# --- Latency & reliability improvements ---
latency-monitor-threshold 0
io-threads 2
io-threads-do-reads yes

# --- Crash safety ---
cluster-allow-reads-when-down yes
